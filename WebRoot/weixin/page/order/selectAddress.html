<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>选择收货地址</title>
	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport"/>
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
	<meta content="telephone=no" name="format-detection"/>
	<link href="../../css/bootstrap.min.css" rel="stylesheet">
	<link href="../../layer/theme/default/layer.css" rel="stylesheet" type="text/css"/>
	<link href="css/selectAddress.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<header class="aui-navBar aui-navBar-fixed">
	<a href="../membercenter/member_center.html" class="aui-navBar-item">
		<i class="icon icon-return"></i>
	</a>
	<div class="aui-center">
		<span class="aui-center-title">收货地址管理</span>
	</div>
</header>

<div class="item-box" id="content">
<!--	<div class="item">-->
<!--		<my>-->
<!--			<div class="receiver">收货人：&nbsp;<smap style="color: #505050;;">左智</smap>-->
<!--			</div>-->
<!--			<div class="phone">13277938897</div>-->
<!--			<div class="address">收货地址：&nbsp;<smap style="color: #505050;;">湖北省武汉市汉阳区龙祥东区啊实打实的</smap>-->
<!--			</div>-->
<!--		</my>-->
<!--		<div class="toolbar">-->
<!--			<img src="images/check.png" style="margin-right: 5px;"><span style="position: relative; top: 2px;">设为默认地址</span>-->
<!--		</div>-->
<!--		<div class="toolbar2">-->
<!--			<img src="images/update.png">-->
<!--			<img src="images/delete.png" style="margin-left: 15px;">-->
<!--		</div>-->
<!--	</div>-->
</div>
<div class="btn-box">
	<button class="btn btn-danger" id="addManual" onclick="goAdd()">添加地址</button>
</div>
</body>
<!-- 引入jQuery核心js文件 -->
<script src="../../js/jquery-1.11.3.min.js"></script>
<script src="../../js/layer.js"></script>
<!-- 引入BootStrap核心js文件 -->
<script src="../../js/bootstrap.min.js"></script>
<script type="text/javascript">
	
    $(function () {
        if(window!==parent){
            $("header").hide();
        }
        $.ajax({
            url: "/wl_address/list",
            type: "get",
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.flag) {
                    var list = data.list , html = "";
                    for (let i = 0; i < list.length; i++) {
                        var item = list[i];
                        html += "<div class=\"item\" id=\""+item.id+"\" onclick=\"select('"+item.id+"')\">";
                        html += "<my>";
                        html += "<div class=\"receiver\">收货人：&nbsp;<smap name=\"ads_name\" style=\"color: #505050;;\">"+item.name+"</smap>";
                        html += "</div>";
                        html += "<div class=\"phone\" name=\"ads_phone\">"+item.phone+"</div>";
                        html += "<div class=\"address\">收货地址：&nbsp;<smap name=\"ads_address\" style=\"color: #505050;;\">"+item.province+item.city+item.county+item.location+"</smap>";
                        html += "</div>";
                        html += "</my>";
                        html += "<div class=\"toolbar\">";
                        if(item.status==1){
                            html += "<img src=\"images/checked.png\" onclick=\"setDefault('"+item.id+"')\" style=\"margin-right: 5px;\"><span style=\"position: relative; top: 2px;\">设为默认地址</span>";
                        }else{
                            html += "<img src=\"images/check.png\" onclick=\"setDefault('"+item.id+"')\" style=\"margin-right: 5px;\"><span style=\"position: relative; top: 2px;\">设为默认地址</span>";
                        }
                        html += "</div>";
                        html += "<div class=\"toolbar2\">";
                        html += "<img src=\"images/update.png\" onclick=\"goUpdate('"+item.id+"')\">";
                        html += "<img src=\"images/delete.png\" onclick=\"del('"+item.id+"')\" style=\"margin-left: 15px;\">";
                        html += "</div>";
                        html += "</div>";
                    }
                    $("#content").html(html);
                } else {
                    layer.msg(data.msg);
                }
            }
        });
    });
    
    /**
		 * 选择
		 */
    function select(id){
        if(window===parent)	return;
        $("#selectAdress .placeholder",parent.document).hide();
        $("#address_info",parent.document).show();
        $("[name=ads_name]",parent.document).text($("#"+id+" [name=ads_name]").text());
        $("[name=ads_phone]",parent.document).text($("#"+id+" [name=ads_phone]").text());
        $("[name=ads_address]",parent.document).text($("#"+id+" [name=ads_address]").text());
        $("[name=address]",parent.document).attr("id",id);
        parent.layer.closeAll();
		}

    /**
		 * 设为默认
     */
    function setDefault(id) {
        $.ajax({
            url: "/wl_address/default/"+id,
            type: "post",
            data: {
                _method:"put",
						},
            dataType: "json",
            success: function (data) {
                layer.msg(data.msg);
                if (data.flag) {
                    $(".toolbar > img").attr("src", "images/check.png");
                    $("#"+id).find(".toolbar > img").attr("src", "images/checked.png");
                }
            }
        });
    }
    
    
    /**
		 * 删除
     */
    function del(id) {
        layer.confirm('确定删除？', {
            btn: ['确定', '取消'], //按钮
            title: false,
            icon: 3,
            closeBtn: false
        }, function (i) {
            $.ajax({
                url: "/wl_address/"+id,
                type: "post",
                data: {
                    _method:"delete",
                },
                dataType: "json",
                success: function (data) {
                    layer.msg(data.msg);
                    if (data.flag) {
                        $("#"+id).remove();
                        if(data.isDefault){
                            setDefault($(".item").eq(0).attr("id"));
                        }
                    }
                }
            });
            layer.close(i);
        }, function (i) {
            layer.close(i);
        });
        
    }

    function goUpdate(id) {
        $(".layui-layer-title", parent.document).text("修改收货地址");
        location.href = "addAddress.html?id="+id;
    }
    
    function goAdd() {
        $(".layui-layer-title", parent.document).text("添加收货地址");
        location.href = "addAddress.html";
    }
</script>

</html>
