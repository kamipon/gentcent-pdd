<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>待处理订单</title>
	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport"/>
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
	<meta content="telephone=no" name="format-detection"/>
	<link href="css/style.css" rel="stylesheet" type="text/css"/>
	<link href="../../layer/theme/default/layer.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/tab.js"></script>
</head>
<body>
<section class="aui-flexView">
	<header class="aui-navBar aui-navBar-fixed">
		<a href="../membercenter/member_center.html;" class="aui-navBar-item">
			<i class="icon icon-return"></i>
		</a>
		<div class="aui-center">
			<span class="aui-center-title">待处理订单</span>
		</div>
	</header>
	<section class="aui-scrollView">
		<div class="aui-tab" data-ydui-tab>
			<ul class="tab-nav">
				<li class="tab-nav-item tab-active">
					<a href="javascript:;">待确认</a>
				</li>
				<li class="tab-nav-item">
					<a href="javascript:;">已完成</a>
				</li>
			</ul>
			<div class="divHeight"></div>
			<div class="tab-panel">
				
				<!--				待确认-->
				<div class="tab-panel-item tab-active" id="o1_items"></div>
				<!--				已完成-->
				<div class="tab-panel-item tab-active" id="o2_items"></div>
			
			</div>
		</div>
	</section>
</section>
<script>
    $(function () {
        init_market();
    });


    function init_market() {
        var statusMap = {"-1":"已失效", "0":"未付款", "1":"已付定金（待审核）",
            "2":"已接单", "3":"备货中", "4":"已确认", "5":"已付尾款（待审核）",
            "6":"发货", "7":"确认收货", "8":"交易成功", "10":"已审订金", "11":"已审尾款",
            "12":"退货中", "13":"已退货", "14":"退款中", "15":"已退款"};
        $.ajax({
            url: "/wx_wlorder_market/market",
            type: "get",
            dataType: "json",
            success: function (data) {
                console.log(data);
                var olist1 = data.olist1;   //待确认
                var olist2 = data.olist2;   //已完成

                //待确认
                for (var i = 0; i < olist1.length; i++) {
                    //订单编号
                    var code = olist1[i].order.code;
                    //订单状态
                    var status = ""+olist1[i].order.status;
                    //购买数量
                    var num = olist1[i].order.num;
                    //总价
                    var total = parseFloat(olist1[i].order.total).toFixed(2);
                    //时间
                    var addTime = new Date(olist1[i].order.addTime).format("yyyy-MM-dd hh:mm:ss");
                    //子订单
                    var son = olist1[i].son;

                    var html = "<div class=\"tab-item\">\n" +
                        "<a href=\"javascript:void(0);\" class=\"aui-well-item aui-well-item-clear\">\n" +
                        "\t<div class=\"aui-well-item-bd\">\n" +
                        "\t\t<h3>订单ID：" + code + "</h3>\n" +
                        "\t</div>\n" +
                        "\t<span class=\"aui-well-wait\">"+statusMap[status]+"</span>\n" +
                        "</a>\n" +
                        "<div class=\"aui-mail-product\">\n" +
                        "\t<a href=\"javascript:void(0);\" class=\"aui-mail-product-item\">\n" +
                        "\t\t<div class=\"aui-mail-product-item-hd\">\n" +
                        "\t\t\t<img src=\"" + son.goodsPic + "\" alt=\"\">\n" +
                        "\t\t</div>\n" +
                        "\t\t<div class=\"aui-mail-product-item-bd\">\n" +
                        "\t\t\t<p>" + son.goodsName + "</p>\n" +
                        "\t\t</div>\n" +
                        "\t</a>\n" +
                        "</div>\n" +
                        "<a href=\"javascript:;\" class=\"aui-mail-payment\">\n" +
                        "\t<p>\n" +
                        "\t\t共<em>" + num + "</em>\n" +
                        "\t\t件商品 总价: ￥<i>" + total + "</i>\n" +
                        "\t</p>\n" +
                        "</a>\n" +
                        "<div class=\"aui-mail-button\">\n" +
                        "\t<a href=\"order_item.html?id="+olist1[i].order.id+"&type=3\">上传资料</a>\n" +
                        "\t<a href=\"javascript:desc('" + olist1[i].order.id + "')\" class=\"aui-df-color\">备注</a>\n" +
                        "</div>\n" +
                        "\t</div>\n" +
                        "<div class=\"divHeight\"></div>";
                    $("#o1_items").append(html);
                }
                if(olist1.length==0){
                    $("#o1_items").append("<div style='text-align: center;width: 100%;margin-top: 20px;'>暂无订单</div>");
                }
                //已完成
                for (var i = 0; i < olist2.length; i++) {
                    //订单编号
                    var code = olist2[i].order.code;
                    //订单状态
                    var status = ""+olist2[i].order.status;
                    //购买数量
                    var num = olist2[i].order.num;
                    //总价
                    var total = parseFloat(olist2[i].order.total).toFixed(2);
                    //时间
                    var addTime = new Date(olist2[i].order.addTime).format("yyyy-MM-dd hh:mm:ss");
                    //子订单
                    var son = olist2[i].son;

                    var html = "<div class=\"tab-item\">\n" +
                        "<a href=\"javascript:void(0);\" class=\"aui-well-item aui-well-item-clear\">\n" +
                        "\t<div class=\"aui-well-item-bd\">\n" +
                        "\t\t<h3>订单ID：" + code + "</h3>\n" +
                        "\t</div>\n" +
                        "\t<span class=\"aui-well-wait\">"+statusMap[status]+"</span>\n" +
                        "</a>\n" +
                        "<div class=\"aui-mail-product\">\n" +
                        "\t<a href=\"javascript:void(0);\" class=\"aui-mail-product-item\">\n" +
                        "\t\t<div class=\"aui-mail-product-item-hd\">\n" +
                        "\t\t\t<img src=\"" + son.goodsPic + "\" alt=\"\">\n" +
                        "\t\t</div>\n" +
                        "\t\t<div class=\"aui-mail-product-item-bd\">\n" +
                        "\t\t\t<p>" + son.goodsName + "</p>\n" +
                        "\t\t</div>\n" +
                        "\t</a>\n" +
                        "</div>\n" +
                        "<a href=\"javascript:;\" class=\"aui-mail-payment\">\n" +
                        "\t<p>\n" +
                        "\t\t共<em>" + num + "</em>\n" +
                        "\t\t件商品 总价: ￥<i>" + total + "</i>\n" +
                        "\t</p>\n" +
                        "</a>\n" +
                        "<div class=\"aui-mail-button\">\n" +
                        "\t<a href=\"order_item.html?id="+olist2[i].order.id+"&type=1000\" class=\"aui-df-color\">查看详情</a>\n" +
                        "</div>\n" +
                        "\t</div>\n" +
                        "<div class=\"divHeight\"></div>";
                    $("#o2_items").append(html);
                }
                if(olist2.length==0){
                    $("#o2_items").append("<div style='text-align: center;width: 100%;margin-top: 20px;'>暂无订单</div>");
                }

            }
        });
    }

    Date.prototype.format = function (fmt) {
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            S: this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) {
            fmt = fmt.replace(
                RegExp.$1,
                (this.getFullYear() + "").substr(4 - RegExp.$1.length)
            );
        }
        for (var k in o) {
            if (new RegExp("(" + k + ")").test(fmt)) {
                fmt = fmt.replace(
                    RegExp.$1,
                    RegExp.$1.length == 1
                        ? o[k]
                        : ("00" + o[k]).substr(("" + o[k]).length)
                );
            }
        }
        return fmt;
    };
</script>
</body>

<style>
	.descitem {
		width: 100%;
		float: left;
		border-bottom: 1px solid rgba(128, 128, 128, 0.15);
		padding: 0px 0px 15px 0px;
	}
	
	.desc1 {
		padding: 20px 20px 0px 20px;
		float: left;
		color: #000;
	}
	
	.desc2 {
		padding: 20px 20px 0px 20px;
		width: 90vw;
		float: left;
		color: #000;
	}
	
	.aui-mar15 {
		margin-bottom: 15px;
	}
	
	.aui-choice-white {
		background: #fff;
		float: left;
		width: 100%;
	}
	
	.aui-flex {
		display: -webkit-box;
		display: -webkit-flex;
		display: flex;
		-webkit-box-align: center;
		-webkit-align-items: center;
		align-items: center;
		padding: 15px 0px 15px 3px;
		position: relative;
		margin: 0;
		border-top: 1px solid rgba(128, 128, 128, 0.15);
	}
	
	button, input, optgroup, select, textarea {
		margin: 0;
		font: inherit;
		color: inherit;
		outline: none;
		background: none;
		border: none;
	}
	
	::-webkit-input-placeholder {
		color: grey;
	}
	
	:-ms-input-placeholder {
		color: grey;
	}
</style>

<script src="../../layer/layer.js"></script>
<script>
    /**
     * 查看备注
     */
    function desc(id) {
        $.ajax({
            url: "/wx_wlorder/getOrder",
            type: "get",
            data: {
                id: id
            },
            dataType: "json",
            success: function (data) {
                if (data.flag) {
                    var order = data.order;
                    if (order.saledesc === "" || order.saledesc == null) {
                        order.saledesc = "未填写备注";
                    }
                    if (order.marketdesc === "" || order.marketdesc == null) {
                        order.marketdesc = "未填写备注";
                    }
                    $("[name=saledesc]").text(order.saledesc);
                    $("[name=marketdesc]").text(order.marketdesc);
                    layer.open({
                        type: 1,
                        title: '备注信息',
                        shadeClose: true,
                        shade: 0.8,
                        area: ['90%', '50%'],
                        content: $('.desc')
                    });
                    $("#descId").val(id);
                } else {
                    layer.msg(data.msg);
                }
            }
        });
    }

    function savedesc() {
        var descId = $("#descId").val();
        var desc = $("#desc").val();
        $.ajax({
            url: "/wx_wlorder/desc/" + descId,
            type: "post",
            data: {
                desc: desc
            },
            dataType: "json",
            success: function (data) {
                if (data.flag) {
                    layer.closeAll();
                    parent.layer.msg(data.msg);
                } else {
                    layer.msg(data.msg);
                }
            }
        });
    }

</script>

<!--备注弹窗-->
<div class="desc" style="display: none;overflow: auto">
	<div class="descitem">
		<div class="desc1">备注人：&nbsp;<smap style="color: #505050;">销售</smap>
		</div>
		<div class="desc2">
			<smap style="color: #505050;" name="saledesc"></smap>
		</div>
	</div>
	
	<div class="descitem">
		<div class="desc1">备注人：&nbsp;<smap style="color: #505050;">市场</smap>
		</div>
		<div class="desc2">
			<smap style="color: #505050;" name="marketdesc"></smap>
		</div>
	</div>
	
	<div style="position: absolute;bottom: 0;width: 100%;padding: 10px;">
		<div class="aui-flex aui-choice-white  aui-mar15">
			<div class="" style=" color: #333;">追加备注</div>
			<input id="desc" type="text" placeholder="请填写备注" style="margin-left: 10px;width: 75%;">
		</div>
		<button style="width: 50%;float: left;height: 35px;	background-color: #1aad19;	border-radius: 5px 0px 0px 5px;color: #fff;"
						onclick="savedesc()">保存
		</button>
		<button style="width: 50%;height: 35px;	background-color: #1e88e5;	border-radius: 0px 5px 5px 0px;color: #fff"
						onclick="layer.closeAll();">取消
		</button>
	</div>
	<input type="hidden" id="descId">
</div>
</html>
