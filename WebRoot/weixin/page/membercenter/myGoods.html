<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>添加商品</title>
	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport"/>
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
	<meta content="telephone=no" name="format-detection"/>
	<link href="../../css/bootstrap.min.css" rel="stylesheet">
	<link href="myGoods.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 顶部导航栏 -->
<div id="top"></div>
<div>
	<div class="aui-ass-link" id="content">
	</div>
</div>
</body>
<!-- 引入jQuery核心js文件 -->
<script src="../../js/jquery-1.11.3.min.js"></script>
<script src="../../js/layer.js"></script>
<!-- 引入BootStrap核心js文件 -->
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/iconfont.js"></script>
<script src="../../js/iconfonta.js"></script>
<script src="../../js/iconfontb.js"></script>
<script type="text/javascript" src="../../js/slider.js"></script>
<script type="text/javascript">
    $("#top").load("../top.html", function () {
        $("#top_title").html("我的商品");
        if (isWeiXin()) {
            $("#top_right").html("<a href='addGoods.html' style='color:green;'>添加商品</a>");
        } else {
            $("#top_right").html("<a href='addGoods-app.html' style='color:green;'>添加商品</a>");
        }
        $("#top_url").attr("href", "../membercenter/member_center.html");
    });

    function isWeiXin() {
        //window.navigator.userAgent属性包含了浏览器类型、版本、操作系统类型、浏览器引擎类型等信息，这个属性可以用来判断浏览器类型
        var ua = window.navigator.userAgent.toLowerCase();
        //通过正则表达式匹配ua中是否含有MicroMessenger字符串
        if (ua.match(/MicroMessenger/i) == 'micromessenger') {
            return true;
        } else {
            return false;
        }
    }

    $(function () {
        init()
    });

    function init() {
        $.ajax({
            url: "/wx_wlgoods/goods",
            type: "get",
            data: {},
            dataType: "json",
            success: function (data) {
                var html = "";
                for (var i = 0; i < data.list.length; i++) {
                    var goods = data.list[i].goods;
                    var specs = data.list[i].specsList[0];
                    var imgListArr = JSON.parse(goods.imgList);
                    var limit = data.limit;
                    var isComplete = goods.isComplete;
                    var src = (imgListArr == null) ? "" : imgListArr[0];

                    console.log(isComplete);
                    var btnhtml = "";


                    if (limit === 1) {	//只能修改

                        btnhtml += "<div><button class='btn btn-success' style='width: 76px;' onclick='updateGoods(\"" + goods.id + "\")'>修改</button></div>";

                    } else if (limit === 2) {

                        if (isComplete === 200) {
                            if (goods.status === 0) {
                                btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-success marg' onclick='szjg(\"" + goods.id + "\")'>设置价格</button></div>";
                                btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-success marg' onclick='sjGoods(\"" + goods.id + "\")'>上架</button></div>";
                                btnhtml += "<div><button class='btn btn-success' style='width: 76px;' onclick='updateGoods(\"" + goods.id + "\")'>修改</button></div>";
                            } else {
                                btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-danger marg' onclick='xjGoods(\"" + goods.id + "\")'>下架</button></div>";
                            }
                        } else if (isComplete === 0 || isComplete === 2) {
                            btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-success marg' onclick='szjg(\"" + goods.id + "\")'>设置价格</button></div>";
                            btnhtml += "<div><button class='btn btn-success' style='width: 76px;' onclick='updateGoods(\"" + goods.id + "\")'>修改</button></div>";
                        } else if (isComplete === 1) {
                            btnhtml += "<div><button class='btn btn-success' style='width: 76px;' onclick='updateGoods(\"" + goods.id + "\")'>修改</button></div>";
                        }

                    } else if (limit === 3) {

                        if (isComplete === 200) {
                            if (goods.status === 0) {
                                btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-success marg' onclick='szmoney(\"" + goods.id + "\")'>设置佣金</button></div>";
                                btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-success marg' onclick='szjg(\"" + goods.id + "\")'>设置价格</button></div>";
                                btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-success marg' onclick='sjGoods(\"" + goods.id + "\")'>上架</button></div>";
                                btnhtml += "<div><button class='btn btn-success' style='width: 76px;' onclick='updateGoods(\"" + goods.id + "\")'>修改</button></div>";
                            } else {
                                btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-danger marg' onclick='xjGoods(\"" + goods.id + "\")'>下架</button></div>";
                            }
                        } else if (isComplete === 0) {
                            btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-success marg' onclick='szmoney(\"" + goods.id + "\")'>设置佣金</button></div>";
                            btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-success marg' onclick='szjg(\"" + goods.id + "\")'>设置价格</button></div>";
                            btnhtml += "<div><button class='btn btn-success' style='width: 76px;' onclick='updateGoods(\"" + goods.id + "\")'>修改</button></div>";
                        } else if (isComplete === 1) {
                            btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-success marg' onclick='szmoney(\"" + goods.id + "\")'>设置佣金</button></div>";
                            btnhtml += "<div><button class='btn btn-success' style='width: 76px;' onclick='updateGoods(\"" + goods.id + "\")'>修改</button></div>";
                        } else if (isComplete === 2) {
                            btnhtml += "<div><button id='xj" + goods.id + "' class='btn btn-success marg' onclick='szjg(\"" + goods.id + "\")'>设置价格</button></div>";
                            btnhtml += "<div><button class='btn btn-success' style='width: 76px;' onclick='updateGoods(\"" + goods.id + "\")'>修改</button></div>";
                        }

                    }
                    var tip = "";
                    if (isComplete === 0) {
                        tip = "未设置佣金、价格";
                    } else if (isComplete === 1) {
                        tip = "未设置佣金";
                    } else if (isComplete === 2) {
                        tip = "未设置价格";
                    }

                    if (isComplete === -1) {
                        html +=
                            "<a href=\"javascript:;\" class=\"aui-flex bordershadow\">" +
                            "<div class=\"aui-ass-img\">" +
                            "<img src=\"" + src + "\" onclick=\"location.href='goodsDetail.html?id=" + goods.id + "'\">" +
                            "</div>" +
                            "<div class=\"aui-flex-box\">" +
                            "基本信息不全<br>请修改商品" +
                            "</div>" +
                            "</div>" +
                            "</div>" +
                            "<div>" +
                            "<div><button class='btn btn-danger' style='width: 76px;' onclick='updateGoods(\"" + goods.id + "\")'>修改</button></div>" +
                            "</div>" +
                            "</a>";
                        continue;
                    }
                    html += "<a href=\"javascript:;\" class=\"aui-flex bordershadow\">";
                    html += "<div class=\"aui-ass-img\">";
                    html += "<img src=\"" + src + "\" onclick=\"location.href='goodsDetail.html?id=" + goods.id + "'\">";
                    html += "</div>";
                    html += "<div class=\"aui-flex-box\">";
                    html += "<h2>" + goods.title + "</h2>";
                    html += "<p>" + goods.subhead + "</p>";
                    html += "<span>库存" + specs.num + "件</span>";
                    if (goods.status == 0) {
                        html += "<span class='btn-success' style='color:#fff;border:none;'>已下架</span>";
                    }
                    if (goods.status == 1) {
                        html += "<span class='btn-danger' style='color:#fff;border:none;'>已上架</span>";
                    }
                    html += "<div class=\"aui-flex aui-flex-one\">";
                    html += "<div class=\"aui-flex-box\" style='margin: 0;'>";
                    if (limit !== 1) {
                        if (specs.price == null) {
                            html += "<h2><em><i>展示价：</i>未设置</em></h2>";
                        } else {
                            html += "<h2><em><i>展示价：￥</i>" + specs.price + "</em></h2>";
                        }
                    }
                    html += "<h2><em style='color: grey'><i>参考价：￥</i>" + specs.onprice + "</em></h2>";
                    if (data.utype == 99) {
                        if (data.list[i].moneymarket == null) {
                            html += "<h2><em style='color: grey'><i>未设置佣金</i></em></h2>";
                        } else {
                            html += "<h2><em style='color: grey'><i>市场佣金：￥</i>" + data.list[i].moneymarket + "</em></h2>";
                            html += "<h2><em style='color: grey'><i>销售佣金：￥</i>" + data.list[i].moneysale + "</em></h2>";
                            html += "<h2><em style='color: grey'><i>物流佣金：￥</i>" + data.list[i].moneywl + "</em></h2>";
                        }
                    }
                    html += "</div>";
                    html += "</div>";
                    html += "</div>";
                    html += "<div style='text-align: right;'>";
                    if (limit === 2 || limit === 3 && tip !== "") {
                        html += "<h2 class='bordertop'>" + tip + "</h2>";
                    }
                    html += btnhtml;
                    html += "</div>";
                    html += "</a>";
                }
                $("#content").html(html);

            }
        });
    }

    //设置价格
    function szjg(id) {
        $.ajax({
            url: "/wx_wlgoods/" + id,
            type: "get",
            data: {},
            dataType: "json",
            success: function (data) {
                if (data.flag) {
                    if (data.option == 1) {
                        location.href = "addGoods2-default.html?wlgoodsId=" + id + "&szjg=1";
                    } else {
                        location.href = "addGoods2.html?wlgoodsId=" + id + "&szjg=1";
                    }
                } else {
                    layer.msg(data.msg);
                }
            }
        });
    }

    //设置佣金
    function szmoney(id) {
        location.href = "szmoney.html?wlgoodsId=" + id;
    }


    function xjGoods(id) {
        layer.confirm('下架该商品？', {
            btn: ['确定', '取消'], //按钮
            title: false,
            icon: 3,
            closeBtn: false
        }, function (i) {
            $.ajax({
                url: "/wx_wlgoods/xjGoods",
                type: "post",
                data: {
                    id: id
                },
                dataType: "json",
                success: function (data) {
                    if (data.flag) {
                        init();
                    } else {
                        layer.msg(data.msg);
                    }
                    layer.close(i);
                }
            });
        }, function (i) {
            layer.close(i);
        });

    }

    function sjGoods(id) {
        layer.confirm('上架该商品？', {
            btn: ['确定', '取消'], //按钮
            title: false,
            icon: 3,
            closeBtn: false
        }, function (i) {
            $.ajax({
                url: "/wx_wlgoods/sjGoods",
                type: "post",
                data: {
                    id: id
                },
                dataType: "json",
                success: function (data) {
                    if (data.flag) {
                        init();
                    } else {
                        layer.msg(data.msg);
                    }
                    layer.close(i);
                }
            });
        }, function (i) {
            layer.close(i);
        });
    }

    function updateGoods(id) {
        if(isWeiXin()){
            location.href = "updateGoods.html?id=" + id;
        }else{
            location.href = "updateGoods-app.html?id=" + id;
				}
    }
</script>

</html>
