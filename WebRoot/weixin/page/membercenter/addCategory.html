<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>添加分类</title>
	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport"/>
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
	<meta content="telephone=no" name="format-detection"/>
	<link href="../../css/bootstrap.min.css" rel="stylesheet">
	<link href="addGoods.css" rel="stylesheet" type="text/css"/>
	<link rel="stylesheet" href="../../css/jquery.richUI.min.css"/>
	<style>
	</style>
</head>
<body>
<div class="container" id="content">
	<!-- <div name='S1' class="input-group" style='margin: 30px 0 0px 0;'>
		<span class="input-group-addon">一级分类</span>
		<select id='S1' class='form-control'>
			<option selected>选择一级分类</option>
			<option value='"+c.id+"'>"+c.name+"</option>
		</select>
	</div> -->
</div>
<div style="width: 100%;position: fixed;bottom: 10px;text-align: center;">
	<button type="button" class="btn btn-success btn-lg" style="width:66%;" onclick="javascript:add()">添加</button>
</div>

</body>

<script type="text/javascript" src="../../js/jquery-1.11.3.min.js"></script>
<script src="../../js/layer.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script type="text/javascript">
    $("#top").load("../top.html", function () {
        $("#top_title").html("商品分类");
        $("#top_url").attr("href", "myGoods.html");
    });

    var _selectedId = "";
    var _selectedName = "";
    $(function () {
        $.ajax({
            url: "/wx_wlcategory",
            type: "get",
            data: {},
            dataType: "json",
            success: function (data) {
                console.log("data", data);
                var html = "<div name='S1' class=\"input-group\"  style='margin: 30px 0 0px 0;'>" +
                    "<span class=\"input-group-addon\">全部分类</span>" +
                    "<select id='S1' class='form-control'>" +
                    "<option value='-1' selected>选择分类</option>";
                for (let i = 0; i < data.clist.length; i++) {
                    const c = data.clist[i];
                    html += "<option value='" + c.id + "'>" + c.name + "</option>"
                }
                html += "</select></div>";
                $("#content").append(html);

                $("select").on("change", function () {
                    _selectedId = $(this).val();
                    _selectedName = $(this).find("option:selected").text();
                    // _selectedId = "";
                    // _selectedName = "";
                    // $(this).parent(".input-group").nextAll().remove();
                    // var temp = $(this).attr("id");
                    // var S = "S"+(parseInt(temp.substring(1))+1);
                    // getChild(S,$(this).val())
                });
            }
        });
    })
    // function getChild(S,id){
    //   	var str = "二级分类";
    //   	if(S == "S3"){
    //   		str = "三级分类"
    //   	}
    //   	$.ajax({
    // 		url: "/wx_wlgoods/category/"+id,
    // 		type: "get",
    // 		data: {},
    // 		dataType: "json",
    // 		success: function(data) {
    // 			$("[name="+S+"]").unbind();
    //   			$("[name="+S+"]").remove();
    // 			if(data.clist.length == 0 ){
    // 				var temp = $("#S"+(parseInt(S.substring(1))-1));
    // 				_selectedId = temp.val();
    // 				_selectedName = temp.find("option:selected").text();
    // 				return
    // 			}
    // 			var html = "<div name='"+S+"' class=\"input-group\"  style='margin: 30px 0 0px 0;'>" +
    // 										"<span class=\"input-group-addon\">"+str+"</span>" +
    // 										"<select id='"+S+"' class='form-control'>" +
    // 											"<option value='-1' selected>选择"+str+"</option>";
    // 			for (let i = 0; i < data.clist.length; i++) {
    // 				const c = data.clist[i];
    // 				html += "<option value='"+c.id+"'>"+c.name+"</option>";
    // 			}
    // 			html += "</select></div>";
    // 			$("#content").append(html);
    //
    // 			$("select").on("change",function(){
    // 				$(this).parent(".input-group").nextAll().remove();
    // 				_selectedId = "";
    // 				_selectedName = "";
    // 				var temp = $(this).attr("id");
    // 				var S = "S"+(parseInt(temp.substring(1))+1);
    // 				getChild(S,$(this).val())
    // 			});
    // 		}
    // 	});
    //   }

    function add() {
        if (_selectedId == "" || _selectedName == "" || _selectedId == "-1") {
            layer.msg("请选择完整的分类");
            return;
        }

        for (var i = 0; i < parent._categoryList.length; i++) {
            if (parent._categoryList[i] == _selectedId) {
                layer.msg("已添加过该分类");
                return;
            }
        }

        var names = $("input[name=category]", parent.document).val();
        if (names != "") {
            names += " , ";
        }
        names += _selectedName;
        $("input[name=category]", parent.document).val(names);
        parent._categoryList.push(_selectedId);
        parent.layer.closeAll();
        parent.layer.msg("添加成功");
    }
</script>
</html>