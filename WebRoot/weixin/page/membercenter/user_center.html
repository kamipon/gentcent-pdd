<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
	<base href="">
	<title>我的钱包</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no">
	<meta http-equiv="x-dns-prefetch-control" content="on">
	<link rel="stylesheet" type="text/css" href="../../../css/mui.min.css">
	<link rel="stylesheet" href="../../../css/demo.css">
	<link rel="stylesheet" type="text/css" href="../../../css/weui.css"/>
	<link rel="stylesheet" type="text/css" href="../../../css/plugins/sweetalert/sweetalert.css">
	<link rel="stylesheet" type="text/css" href="user_center.css">
	<script type="text/javascript" src="../../../js/mui.min.js"></script>
	<script type="text/javascript" src="../../../js/jquery1.9.1.js"></script>
	<link href="../../layer/theme/default/layer.css" rel="stylesheet" type="text/css"/>
	<script src="../../js/layer.js"></script>
	<script type="text/javascript" src="../../../js/plugins/sweetalert/sweetalert.min.js"></script>
	<link href="../order/css/style.css" rel="stylesheet" type="text/css"/>
	<style type="text/css">
		.mui-table-view-cell:after {
			left: 0;
		}
	</style>
</head>
<body>
<header class="aui-navBar aui-navBar-fixed">
	<a href="../membercenter/member_center.html" class="aui-navBar-item">
		<i class="icon icon-return"></i>
	</a>
	<div class="aui-center">
		<span class="aui-center-title">我的钱包</span>
	</div>
</header>


<div id="hidebg"></div>
<section class="ui-container">
	<section id="table">
		<div class="demo-item">
			<div class="demo-block">
				<div class="bg" style="height: 12%;	text-align: center;">
					<div class="headImg" style="margin-top: 38px;border-radius:55px;">
						<img alt="image" src="" name="imgUrl" style="height:85px ;width:85px;border-radius:55px"/>
					</div>
					<div class="nick" style="margin-top: 38px;"><font size="4" color="black" name="nick"></font></div>
				</div>
			</div>
		</div>
	</section>
</section>
<div class="middle">
	<p class="des">当前余额:<font color="F95052" class="mm" name="balance"></font>元</p>
	<div style="background-color: rgba(236, 236, 236, 0.29);width: 100%;height: 50px;overflow: visible;border-bottom: rgba(211, 211, 211, 0.5) 1px solid;margin-top: 10px;">
		<div style="display: flex;flex-direction: column;width: 50%;height: 100%;float:left;text-align: center; justify-content: center; align-items: center;">
			累计收入（元）<br>
			<font style="color: #d85959;">
				+
				<span name="money"></span>
				&nbsp;&nbsp;&nbsp;
			</font>
		</div>
		<div style="height: 70%; margin-top: 7px; border-right: rgba(211, 211, 211, 0.5) 1.5px solid; float: left;"></div>
		<div style="display: flex;flex-direction: column;width: 49%;height: 100%;float:left;text-align: center; justify-content: center;align-items: center;">
			累计转出（元）<br>
			<font style="color: #539e56">
				-
				<span name="tixian"></span>
				&nbsp;&nbsp;&nbsp;
			</font>
		</div>
	</div>


</div>
<div class="attention">
	<div style="line-height: 100%">
		<h3 class="ti">温馨提示</h3>
		<p class="desc">每15天您的收入将结算至您的余额，点击已结算佣金可以查看结算记录；</p>
		<p class="desc">余额=累计收入（已结算收入）-累计转出（已提现记录）</p>
		<p class="desc">不可提现收入=订单还未完成，未结算的订单收入</p>
	</div>
</div>

<div style="width: 100%;text-align: center;">
	<input type="button" name="button" value="提现" id="withdrawals" onclick="showTixian();">
</div>

<div style="float: left;width: 100%;" class="foo">
	<ul class="mui-table-view">
		<li class="mui-table-view-cell" id="saveRedTotalRecords">
			<img src="images/e891d25eb4b78dd614f78ab1d7c07adc.png" style="height: 18px;width: 18px;vertical-align:middle"/>
			<span name="record-text">
						不可提现收入
					</span>
			<span class="num">
               + <span name="money_w"></span>
			</span>
		</li>
		<li class="mui-table-view-cell" id="saveRedRecords">
			<img src="images/e891d25eb4b78dd614f78ab1d7c07adc.png" style="height: 18px;width: 18px;vertical-align:middle"/>
			<span name="record-text">
						已结算收入
					</span>
			<span class="num">
               + <span name="money"></span>
			</span>
		</li>
		
		<li class="mui-table-view-cell" id="withdrawalRecords">
			<img src="images/7db0e5bfe43c08dd468bc0742d7e8b91.png" style="height: 18px;width: 18px;vertical-align:middle"/>
			<span>
						已提现记录
					</span>
			<span class="num" style="color:#539e56;">
						- <span name="tixian"></span>
					</span>
		</li>
		<li class="mui-table-view-cell" id="withdrawalInfo">
			<img src="images/7db0e5bfe43c08dd468bc0742d7e8b91.png" style="height: 18px;width: 18px;vertical-align:middle"/>
			<span>
						提现信息设置
					</span>
		</li>
	</ul>
</div>

<div class="tongzhi" id="moneyDiv" style="display:none">
	<div class="weui-cells__title">提现</div>
	<div class="weui-cells">
		<!--		<div class="weui-cell" id="checkout">-->
		<!--			<div class="weui-cell__bd">-->
		<!--				<div style="text-align: center;height: 24px;">-->
		<!--					<font style="float:left;width: 100%;">短信验证</font>-->
		<!--				</div>-->
		<!--				<div style="margin-top: 10px">-->
		<!--					<input class="weui-input" id="phone" type="text" value="" placeholder="请输入手机号"-->
		<!--								 style="height:30px;width:130px;float:left;margin-right:3px;">-->
		<!--					<input class="weui-input"-->
		<!--								 style="cursor:pointer;background-color: #18a689;color: rgb(255, 255, 255);width: 40%;height: 30px;border:0;"-->
		<!--								 onclick="allow(this);" value="获取验证码" type="button">-->
		<!--				</div>-->
		<!--				<div id="xianshi" style="margin-top: 10px;display: none; ">-->
		<!--					<input class="weui-input" type="hidden" valu="0" id="istxyzm" style="height:30px;">-->
		<!--					<input class="weui-input" type="text" placeholder="请输入动态码" calss="form-control" maxlength="4" name="captcha"-->
		<!--								 id="captcha" style="width:130px;float:left;height: 34px;">-->
		<!--					<img id="captchaImg" class="validateCodeImg" onclick="changeCaptcha('captchaImg');" title="看不清？换一张"-->
		<!--							 src="api/system/getCaptcha"-->
		<!--							 style="cursor: pointer; height: 30px;margin-left: 20px;margin-top: 4px;">-->
		<!--				</div>-->
		<!--				<div style="margin-top: 10px">-->
		<!--					<input class="weui-input" id="phoneCode" type="text"-->
		<!--								 style="width:130px;float:left;margin-right:3px;height:30px;" value="" placeholder="请输入验证码">-->
		<!--					<input style="cursor:pointer;background-color: #18a689;color: rgb(255, 255, 255);width: 40%;height: 30px;border:0;"-->
		<!--								 value="验证" onclick=" checkout();" type="button">-->
		<!--				</div>-->
		<!--			</div>-->
		<!--		</div>-->
		<div class="weui-cell">
			<div class="weui-cell__bd">
				<input class="weui-input" type="text" value="" id="money" style="margin-bottom: 0px;" placeholder="请输入提现金额">
				<input type="hidden" value="" id="realMoney">
			</div>
		</div>
	</div>
	<div class="tongzhibtn" id="money_fabu">
		确定
	</div>
	<div class="quxiaobtn" id="money_quxiao">
		取消
	</div>
</div>
<form action="" id="look">
	<input type="hidden" value="" name="id">
</form>
</body>
<script type="text/javascript">

    $(function () {
        init();
    });

    var _id;
    var _balance;

    function init() {
        $.ajax({
            url: "/wx_wlmember/money",
            type: "get",
            data: {},
            dataType: "json",
            success: function (data) {
                console.log(data);
                if (data.flag) {
                    var m = data.member;
                    if (m.utype == 1) {
                        // $("[name=record-text]").text("交易记录");
                    }
                    $("[name=balance]").text(parseFloat(data.balance).toFixed(2));
                    $("[name=money]").text(parseFloat(data.money).toFixed(2));
                    if (data.money_w == null || data.money_w == '') {
                        $("[name=money_w]").text(parseFloat(0).toFixed(2));
                    } else {
                        $("[name=money_w]").text(parseFloat(data.money_w).toFixed(2));
                    }

                    $("[name=tixian]").text(parseFloat(data.tixian).toFixed(2));
                    $("[name = imgUrl]").attr("src", m.picUrl);
                    $("[name = nick]").text(m.nick);

                    _id = m.id;
                    _balance = m.balance;

                    if (m.titype == 1) {
                        if (m.zfb == null || m.zfb == ""
                            || m.zfbname == null || m.zfbname == "") {
                            $("#withdrawals").val("请完善提现信息");
                            $("#withdrawals").attr("onclick", "$('#withdrawalInfo').click()");
                            $("#withdrawals").css({background: "linear-gradient(to right, #9E9E9E, #585858)"});
                        }
                    } else if (m.titype == 2) {
                        if (m.cardrealname == null || m.cardrealname == ""
                            || m.cardnumber == null || m.cardnumber == ""
                            || m.cardfrom == null || m.cardfrom == "") {
                            $("#withdrawals").val("请完善提现信息");
                            $("#withdrawals").attr("onclick", "$('#withdrawalInfo').click()");
                            $("#withdrawals").css({background: "linear-gradient(to right, #9E9E9E, #585858)"});
                        }
                    } else {
                        $("#withdrawals").val("请完善提现信息");
                        $("#withdrawals").attr("onclick", "$('#withdrawalInfo').click()");
                        $("#withdrawals").css({background: "linear-gradient(to right, #9E9E9E, #585858)"});
                    }

                } else {
                    layer.msg(data.msg);
                }
            }
        });
    }


    // var yanzheng = false;

    // $(function () {
    //     if ('${member.phone}' != '' && '${member.phone}' != null) {
    //         $('#checkout').hide();
    //         yanzheng = true;
    //     }
    // });


    // function changeCaptcha(id) {
    //     $('#' + id).attr("src", $('#' + id).attr("src") + "?" + Math.random());
    // }
    //
    // function allow(a) {
    //     //动态码
    //     var captcha = $.trim($("input[name='captcha']").val());
    //     var istxyzm = $.trim($("#istxyzm").val());
    //     var phone1 = $("#phone").val();
    //     var reg = /^1[3|4|5|7|8][0-9]{9}$/; //验证规则
    //     var flag = !reg.test(phone1); //true
    //     if (flag) {
    //         mui.alert("", "请输入正确的手机号！");
    //         return;
    //     }
    //     if (istxyzm == 1) {
    //         flag = valid([[captcha, "请输入动态码!"]]);
    //         if (!flag) {
    //             return;
    //         }
    //     }
    //     $.ajax({
    //         url: "userCenter/getCode",
    //         type: "post",
    //         data: {
    //             captcha: captcha,
    //             phone: phone1
    //         },
    //         dataType: "json",
    //         success: function (data) {
    //             if (data.flag) {
    //                 if (data.message != "") {
    //                     mui.alert("", data.message);
    //                 }
    //                 time(a);
    //             } else {
    //                 if ((data.istxyzm + "") == "1") {
    //                     $("#xianshi").css("display", "block");
    //                     $("#istxyzm").val(1);
    //                 }
    //                 mui.alert("", data.message);
    //             }
    //         }
    //     });
    // }
    //
    // //等待60s，可重新获取验证码
    // var wait = 60;
    // var statu = true;
    //
    // function time(o) {
    //     if (wait == 0) {
    //         o.value = "获取验证码";
    //         $(o).css("background-color", "#18a689");
    //         wait = 60;
    //         statu = true;
    //     } else {
    //         o.value = wait;
    //         $(o).css("background-color", "#c2c2c2");
    //         wait--;
    //         statu = false;
    //         setTimeout(function () {
    //             time(o);
    //         }, 1000)
    //     }
    //     //不可点击
    //     if (!statu) {
    //         $(o).attr("disabled", true);
    //         $(o).css("cursor", "auto");
    //     }
    //     if (statu) {
    //         $(o).removeAttr("disabled");
    //         $(o).css("cursor", "pointer");
    //     }
    // }

    //验证验证码是否正确
    // function checkout() {
    //     var memberId = "${member.id}";
    //     var code = $("#phoneCode").val();
    //     var phone1 = $("#phone").val();
    //     var flag = valid([
    //         [phone1, "请输入手机号!"],
    //         [code, "请输入验证码!"]
    //     ]);
    //     if (!flag) {
    //         return;
    //     }
    //     var data1 = {"phone": phone1, "code": code, "memberId": memberId};
    //     $.ajax({
    //         url: "userCenter/validate",
    //         type: "post",
    //         data: data1,
    //         dataType: "json",
    //         success: function (data) {
    //             if (data.flag) {
    //                 if (data.message != "" && data.message != undefined) {
    //                     mui.alert("", data.message);
    //                     yanzheng = true;
    //                     $("#checkout").hide();
    //                 }
    //             } else {
    //                 if (data.message != "" && data.message != undefined) {
    //                     mui.alert("", data.message);
    //                 }
    //             }
    //         }
    //     });
    // }

    // function valid(arrDM) {
    //     for (var i in arrDM) {
    //         if (arrDM[i][0] == '') {
    //             mui.alert("", arrDM[i][1]);
    //             return false;
    //         }
    //     }
    //     return true;
    // }


    //提现显示
    function showTixian() {
        $("#hidebg").show();
        $("#moneyDiv").show();
    }

    //提现隐藏
    $("#money_quxiao").on("click", function () {
        if ($("#moneyDiv").css("display") != 'none') {
            $("#money").val("");
            $("#hidebg").hide();
            $("#moneyDiv").hide();
        }
    });
    //ajax提交控制对象
    var post_flag = false;
    //提现
    $("#money_fabu").on("click", function () {

        // if (!yanzheng) {
        //     mui.alert("", "请先通过验证");
        //     return;
        // }
        //如果正在提交直接返回
        if (post_flag) {
            mui.alert("", "请勿重复提交");
            return;
        }
        post_flag = true;
        //提现余额
        var money = parseFloat($.trim($("#money").val()));
        //余额
        var realMoney = parseFloat(_balance);
        //判断
        var flag = true;
        if (isNaN(money)) {
            mui.alert("", "请输入提现金额");
            post_flag = false;
            return;
        }
        if (money < 1) {
            post_flag = false;
            mui.alert("", "提现金额必须大于1元");
            if ($("#moneyDiv").css("display") != 'none') {
                $("#money").val("");
                $("#hidebg").hide();
                $("#moneyDiv").hide();
            }
            return;
        }
        if (money > realMoney) {
            flag = false;
            post_flag = false;
            mui.alert("", "提现金额超过余额");
            if ($("#moneyDiv").css("display") != 'none') {
                $("#money").val("");
                $("#hidebg").hide();
                $("#moneyDiv").hide();
            }
            return;
        }
        if (flag) {
            $.ajax({
                url: "/wx_wlmember/addti",
                type: "post",
                data: {
                    "money": money
                },
                dataType: "json",
                success: function (data) {
                    if ($("#moneyDiv").css("display") != 'none') {
                        $("#money").val("");
                        $("#hidebg").hide();
                        $("#moneyDiv").hide();
                    }
                    if (data.flag) {
                        $("#rest").html("余额：" + data.money);
                        swal({title: data.msg, type: "success"}, function () {
                            window.location.reload();
                        });
                    } else {
                        mui.alert("", data.msg + _id);
                        $(".mui-popup").css("width", "90%");
                        post_flag = false;
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    mui.alert("", "出错了，请稍后再试" + XMLHttpRequest.readyState + ":" + XMLHttpRequest.status + "\n " + textStatus + " \n " + errorThrown);
                }
            });
        }
    });
    $("#withdrawalRecords").on("click", function () {
        location.href = "withdrawalrecord.html";
    });
    $("#saveRedRecords").on("click", function () {
        location.href = "saveredrecord.html";
    });
    $("#withdrawalInfo").on("click", function () {
        location.href = "withdrawalInfo.html";
    });
</script>
</html>

